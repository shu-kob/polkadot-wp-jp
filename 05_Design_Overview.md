5. Design Overview

このセクションでは、システム全体について簡単に説明することを目的としています。より徹底的なシステムの探求は、それに続くセクションで行われます。

5.1. Consensus.

リレーチェーン上では、Polkadotは最新の非同期ビザンチン耐故障（BFT）アルゴリズムによって、相互に合意した有効ブロックのセットに対する低レベルの合意を達成します。このアルゴリズムは、シンプルなTendermint [11]と、実質的により複雑なHoneyBadgerBFT [14]に触発されたものである。後者は、ほとんど良性の権威または検証者のセットが与えられたときに、任意の欠陥のあるネットワークインフラ上で効率的かつ耐故障性のあるコンセンサスを提供する。

しかし、Polkadotは、特定の組織や信頼できる機関が維持する必要のない、完全にオープンで公的な状況のネットワークとして展開することも想定しています。そのため、検証者のセットを決定し、誠実であるようにインセンティブを与える手段が必要です。そのために、PoSに基づく選択基準を利用する。

5.2. Proving the Stake.

ネットワークには、特定のアカウントがどれだけの「賭け金」を持っているかを測定する何らかの手段があると仮定する。既存のシステムとの比較を容易にするため、測定単位を「トークン」と呼ぶことにします。残念ながら、この用語は、アカウントに関連する単なるスカラー値であるため、個性の概念がないなど、多くの理由から理想的とはいえない。

バリデータは、NPoS (Nominated Proof-of-Stake) スキームにより、不定期（多くても1日1回、少ない場合は四半期に1回）に選出されるものと考える。インセンティブは、トークン・ベースの拡大による資金の比例配分（年間最大100%、ただし10%程度が望ましい）と、徴収された取引手数料によって実現される可能性があります。一般的にマネタリーベースの拡大はインフレを引き起こすが、すべてのトークン所有者に公平な参加の機会が与えられるため、コンセンサスメカニズムの役割を喜んで担うのであれば、保有するトークンの価値が時間とともに減少するようなことはないだろう。特定の割合のトークンがステークプロセスのターゲットとなり、このターゲットに到達するために、市場ベースのメカニズムを通じて有効なトークン・ベースの拡大が調整されます。

バリデータはその賭け金によって大きな絆で結ばれている。退出したバリデータの債券は、バリデータの任務が終了した後もずっと残っている（おそらく3ヶ月程度）。この長い債券償還期間により、将来的な不品行を、チェーンの定期的なチェックポイントまで 罰することができる。不正行為により、報酬の減額や、ネットワークの整合性を故意に損ねた場合には、バリデ ータは他のバリデータ、情報提供者、利害関係者全体に対して、一部または全部の持ち分を失う (焼却処分)などの処罰が下される。例えば、フォークの両ブランチを批准しようとするバリデータ(「短距離攻撃」とも呼ばれる) は、後者の方法で特定され、処罰される可能性がある。

長距離の「何もしない」攻撃(このような攻撃では、敵対者が創世記のブロック以降にまったく新しい歴史の連鎖を構築します。オフセット時に比較的重要でないステークをコントロールすることで、彼らは代替の歴史における唯一の積極的な参加者であるため、他のすべてのステークホルダーと比較してステークを徐々に増加させることができる。ブロックの作成に本質的な物理的制限は存在しないため（PoWとは異なり、かなりの計算エネルギーを費やさなければならない）、彼らは比較的短い時間で実際のチェーンよりも長いチェーンを作ることができ、それを最長かつ最高のものにしてネットワークの標準的な状態を引き継ぐ可能性があります。
) は、単純な「チェックポイント」ラッチによって回避され、 特定の鎖の深さを超える危険な鎖の再編成を防ぐことができます。新しく接続されたクライアントが間違ったチェーンに誘導されないように、定期的に「ハードフォーク」を行い、最近のチェックポイントのブロックハッシュをクライアントにハードコーディングする（最大でバリデータの債券清算期間と同じ）。これは、「有限のチェーンの長さ」または定期的な生成ブロックのリセットという、さらに足跡を減らす方法とうまく調和する。

Figure 2.

Polkadotシステムの概要図。コレーターがユーザーの取引を収集・伝達し、ブロック候補をフィッシャーマンとバリデーターに伝達している様子を示しています。また、あるアカウントが自分のパラチェーンからリレーチェーンを経由して別のパラチェーンにトランザクションを投稿し、それがそのパラチェーンのアカウントへのトランザクションとして解釈される様子も描かれている。

5.3. Parachains and Collators.

パラチェーンのヘッダーはリレーチェーンブロックの中に封印され、確認後に再編成や「二重支出」ができないようになっています。これは、ビットコインのサイドチェーンやマージマイニングが提供するセキュリティと同様の保証です。しかし、Polkadotは、パラチェーンの状態遷移が有効であることも強力に保証している。これは、バリデータのセットを暗号的にランダムに分割し、パラチェーンごとに1つのサブセットを作成し、ブロックごとにサブセットが異なる可能性があることで実現します。この設定は一般に、パラチェインのブロック時間が少なくともリレーチェインと同程度になることを意味する。パーティショニングを決定する具体的な方法は本書の範囲外であるが、RanDAO [19]に類似したコミット-リバルのフレームワークを使用するか、暗号的に安全なハッシュの下で各パラチェインの以前のブロックから組み合わせたデータを使用するかのいずれかである可能性が高いだろう。

このようなバリデータのサブセットは、有効性が保証されたパラチェーンブロック 候補を提供する必要がある(債券の没収を覚悟の上で)。1つ目は、本質的に有効であること、すなわちすべての状態遷移が忠実に実行され、 参照されるすべての外部データ（すなわちトランザクション）が有効であることである。第二に、外部トランザクションのような候補の外部にあるデータは、参加者がそれをダウンロードして手動でブロックを実行できるように、十分に高い可用性を備えていることである。(このようなタスクは、バリデータ間で共有することもできるし、可用性保証者と呼ばれる緊密に結合したバリデータの集合の指定タスクとすることもできるだろう。)検証者は外部の「取引」データを含まない「null」ブロックだけを提供することもできるが、そうすると報酬が減るというリスクを負うことになる。ValidatorはParachainゴシッププロトコルと連携し、Collatorは取引をブロックに照合し、ブロックが親の有効な子であることを非対話的かつゼロ知識で証明する（そしてそのための取引手数料を受け取る）。

リレーチェーンが課す「計算資源計量」や「取引手数料」という基本的な概念は存在しないため、スパムを防止するための独自の手段を指定することはパラチェーンプロトコルに任されている。また、リレーチェーンプロトコルによる直接的な強制もありません（ただし、関係者が適切なメカニズムを提供しないパラチェーンを採用することはあり得ません）。

これは、イーサリアムとは異なるチェーン、例えば、よりシンプルな手数料モデルを持つビットコインのようなチェーンや、他のまだ提案されていないスパンプ防止モデルの可能性を明示的に示しているのです。Polkadotのリレーチェーン自体は、おそらくEthereumのようなアカウントと状態のチェーンとして存在し、おそらくEVMderivativeになるでしょう。リレーチェーンノードは他の処理も行う必要があるため、トランザクションのスループットは部分的に多額のトランザクション手数料や、研究モデルで必要となるブロックサイズの制限によって最小化されるでしょう。

5.4. Interchain Communication.

Polkadotの最後の重要な要素は、チェーン間通信です。パラチェーン同士はある種の情報チャネルを持つことができるので、Polkadotはスケーラブルなマルチチェーンと考えることができます。パラチェーンで実行されるトランザクションは、（そのチェーンのロジックに従って）第2のパラチェーン、あるいは潜在的にはリレーチェーンへのトランザクションのディスパッチを実現することができます。プロダクションブロックチェーン上の外部取引と同様に、パラチェーンは完全に非同期であり、いかなる種類の情報もその起源に戻すという本質的な能力はありません。

最小限の実装の複雑さ、最小限のリスク、将来のパラチェーンアーキテクチャのストレートジャケッティングを保証するために、これらのインターチェーントランザクションは、標準的な外部署名付きトランザクションと実質的に区別がつかないようになっています。取引は、パラチェーンを識別する能力を提供するオリジンセグメントと、任意のサイズにすることができるアドレスを持つ。ビットコインやイーサリアムのような一般的な現行システムとは異なり、インターチェーン取引には何らかの手数料の「支払い」が伴わない。そのような支払いは、送信元と送信先のパラチェーン上での交渉ロジックによって管理されなければならない。EthereumのSerenityリリース[7]で提案されたようなシステムは、このようなクロスチェーンのリソース支払いを管理するシンプルな手段となるでしょうが、いずれは他のものも登場すると思われます。

チェーン間取引は、忠実性を確保するためにMerkle木を中心としたシンプルなキューイング機構を使用して解決されます。あるパラチェーンの出力キューにあるトランザクションを、送信先のパラチェーンの入力キューに移すのは、リレーチェーンメンテナーの仕事である。渡されたトランザクションはリレーチェーン上で参照されますが、リレーチェーントランザクションそのものではありません。あるパラチェーンが他のパラチェーンにトランザクションのスパムをかけるのを防ぐため、トランザクションを送信するためには、前のブロックの終了時に送信先の入力キューが大きすぎないことが必要である。ブロック処理後に入力キューが大きすぎる場合、それは「飽和」とみなされ、制限値以下に減少するまで、後続のブロック内でトランザクションがルーティングされない可能性があります。これらのキューはリレーチェーン上で管理され、パラチェーンが互いの飽和状態を判断できるようになっている。このようにして、停滞した宛先へのトランザクションのポストが失敗した場合、同期的に報告することができる。(ただし、リターンパスが存在しないため、二次トランザクションがその理由で失敗した場合、元の呼び出し元に報告することはできず、他の回復手段が必要である)。

5.5. Polkadot and Ethereum.

イーサリアムのチューリング完全性により、少なくとも容易に推測できるセキュリティの範囲内で、Polkadotとイーサリアムが相互運用できる十分な機会があると期待しています。つまり、Polkadot からのトランザクションはバリデータによって署名され、その後イーサリアムに送り込まれ、そこでトランザクション転送契約によって解釈・実行されることが想定される。また別の方向では、特定のメッセージが転送されるべきかどうかを迅速に検証できるように、「脱走契約」から来る特別な形式のログ（イベント）を使用することを想定している。

5.5.1. Polkadot to Ethereum.

承認投票メカニズムによって決定された利害関係者の集合から形成されるバリデーターを持つBFT合意メカニズムを選択することによって、我々は、頻繁に変更されない適度な数のバリデーターで安全な合意を得ることができます。144人のバリデータ、4秒のブロックタイム、900ブロックのファイナリティ（二重投票のような悪意のある行為を報告、処罰、修復することが可能）を持つシステムでは、ブロックの有効性はわずか97の署名（144の2/3＋1）、およびチャレンジが寄託されていない次の60分の検証期間によって合理的に証明されると考えることができる。

イーサリアムは、144人の署名者を維持し、彼らによって制御されることができる「ブレークイン・コントラクト」をホストすることができます。楕円曲線デジタル署名（ECDSA）の復元にはEVMで3,000ガスしかかからないため、また検証は（全会一致ではなく）検証者の超多数で行われることが望ましいため、Polkadotネットワークからの命令が適切に検証されたことを確認するための基本コストは30万ガス以下、ブロックガスの合計上限550万のわずか6％にすぎません。検証者の数を増やせば（数十のチェーンに対応するために必要）必然的にこのコストは増加しますが、イーサリアムの取引帯域幅は技術の成熟とインフラの改善に伴い、時間とともに拡大することが広く予想されます。また、すべてのバリデータが関与する必要はない（例えば、最も高いステークを持つバリデータ のみがこの作業に呼ばれる）ため、この仕組みの限界は十分にある。

このようなバリデーターを毎日交代で配置すると仮定すると（これはかなり保守的で、毎週あるいは毎月でも可）、このイーサリアム転送ブリッジを維持するためのネットワークへのコストは、1日あたり約54万ガス、現在のガス価格では年間45ドルであろう。ブリッジを経由して転送される基本的な取引は約0.11ドルで、追加の契約計算には当然ながらもっとコストがかかる。トランザクションをバッファリングしてバンドルすることで、侵入許可コストを簡単に共有でき、トランザクションあたりのコストを大幅に削減できる。転送前に20トランザクションが必要な場合、基本トランザクションの転送コストは約0.01ドルにまで低下することになる。

このマルチシグネチャ契約モデルの興味深い、かつ安価な代替案の1つは、マルチラテラル・オーナーシップ・セマンティクスを実現するために、閾値署名を使用することである。ECDSA の閾値署名方式は計算コストが高いですが、Schnorr 署名のような他の方式では非常に合理的です。Ethereumは、来るべきMetropolisハードフォークで、このような方式を安価に利用できるプリミティブを導入する予定です。もしそのような手段を利用することができれば、PolkadotトランザクションをEthereumネットワークに転送するためのガスコストは、署名の検証や基礎となるトランザクションを実行するための基本コスト以上のオーバーヘッドをほぼゼロにまで劇的に減少させることができるだろう。

このモデルでは、Polkadot のバリデータ・ノードはメッセージに署名する以外にはほとんど何もする必要がない。トランザクションを実際にイーサリアムネットワークにルーティングさせるために、バリデ ータ自身もイーサリアムネットワークに常駐するか、より可能性が高いのは、メッセージをネットワー クに転送した最初のアクターに小さな報奨金を提供することである（報奨金は当然、トランザクションの発行者に支払われる可能性がある）。

5.5.2. Ethereum to Polkadot.

EthereumからPolkadotにトランザクションを転送するには、単純なログの概念を使用します。イーサリアムのコントラクトがトランザクションをPolkadotの特定のパラチェーンにディスパッチしたい場合、それは単に特別な「ブレイクアウトコントラクト」を呼び出す必要があります。ブレイクアウト・コントラクトは、必要とされる可能性のあるあらゆる支払いを受け取り、その存在がマークル証明と対応するブロックのヘッダーが有効かつ正規であるという主張を通じて証明されるように、ロギング命令を発行する。

後者の2つの条件のうち、有効性はおそらく、証明するのが最も簡単である。原理的には、証明を必要とする各ポルカドットノード（すなわち指定された検証者ノード）が、標準的なイーサリアムノードの完全に同期したインスタンスを実行していることが唯一の要件である。残念ながら、これ自体がかなり重い依存関係です。より軽量な方法としては、ブロック内のトランザクションを適切に実行し、（ブロック受信に含まれる）ログが有効であることを確認するために必要なイーサリアムの状態トライの部分のみを提供することによって、ヘッダーが正しく評価されたという単純な証明を使用することである。このような「SPV的」(SPVとは、ビットコインにおけるSimplified Payment Verificationのことで、クライアントが最長PoWチェーンの全ブロックヘッダーのコピーだけを保持しながら取引を検証する方法を説明するものである。)な証明は、まだ相当量の情報を必要とするかもしれません。便利なことに、それらは通常全く必要ないでしょう。ポルカドット内部のボンドシステムは、他の第三者（「fisherman」など、6.2.3参照）がヘッダーが無効であるという証明（特にステートルートや受領ルートが偽者であるという証明）を提出した場合に、ボンドを失ったリスクで、ボンドを受けた第三者がヘッダーを提出できるようにするものでしょう。

Ethereumのような非最終的なPoWネットワークでは、正準性を決定的に証明することは不可能である。これに対処するため、何らかのチェーン依存の因果関係に頼ろうとするアプリケーションは、「確認」の回数、または依存するトランザクションがチェーン内のある特定の深さに達するまで待ちます。イーサリアムでは、この深さは、ネットワークの問題が知られていない最も価値の低い取引のための1ブロックから、取引所向けの最初のフロンティアリリース時のような1200ブロックまで様々です。安定した「Homestead」ネットワークでは、この数値はほとんどの取引所で120ブロックに収まっており、私たちも同様のパラメータを取る可能性が高いでしょう。

つまり、イーサリアムネットワークから新しいヘッダーを受け入れ、PoWを検証することができ、十分な深さのヘッダーに対してイーサリアム側のブレイクアウト契約によって特定のログが発行されたという証明を受け入れることができ（そしてPolkadot内で該当メッセージを転送）、最後に以前受け入れられたがまだ実行されていないヘッダーに無効な受信ルートが含まれているという証明を受け入れることができるようになることで、我々のPolkadot側イーサリアムインタフェースにはいくつかの簡単な機能を想像できるのである。

実際にEthereumヘッダーデータ自体（およびSPV証明や有効性/正統性の反論）をPolkadotネットワークに取り込むには、データを転送するためのインセンティブが必要です。これは、ヘッダーが有効である有用なブロックを転送できた人に支払われる（イーサリアム側で収集した手数料で賄われる）支払いのような単純なものでもよい。検証者は、フォークを管理できるように、プロトコルに内在する手段またはリレーチェーン上で維持される契約を通じて、過去数千ブロックに関連する情報を保持することが要求されるでしょう。

5.6. Polkadot and Bitcoin.

ビットコインの相互運用は、Polkadotにとって興味深い挑戦です。いわゆる「双方向ペグ」は、両方のネットワーク側にある便利なインフラです。しかし、ビットコインの制限により、このようなペグを安全に提供することは、自明なことではありません。ビットコインからPolkadotへのトランザクションの配信は、原理的にはイーサリアムと同様のプロセスで行うことができます。Polkadotの検証者が何らかの方法で管理する「ブレイクアウトアドレス」が、転送されたトークン（およびそれに付随して送信されるデータ）を受け取ることができるのです。SPV の証明はインセンティブ付きのオラクルによって提供され、確認期間とともに、取引が「二重支出」されたことを示唆する非正規のブロックを特定すると報奨金が与えられる可能性があります。その後、「ブレイクアウトアドレス」に所有されるトークンは、原則的に同じバリデーターによって管理され、後に分散されることになる。

しかし、問題はどのようにしたら回転するバリデータから預金を安全に管理できるかである。署名の組み合わせで任意に判断できるイーサリアムとは異なり、ビットコインは実質的に制限されており、ほとんどのクライアントが最大3者のマルチ署名取引しか受け付けない。これを36人、あるいは最終的に希望する数千人にまで拡大することは、現在のプロトコルでは不可能である。1つの選択肢は、そのような機能を可能にするためにビットコインのプロトコルを変更することですが、ビットコインの世界でいわゆる「ハードフォーク」は、最近の試みから判断して手配するのが困難です。1つの可能性は、閾値署名の使用です。これは、1つの識別可能な公開鍵が複数の秘密の「部分」によって効果的に制御されるようにする暗号方式で、有効な署名を作成するためにはその一部または全部を利用する必要があります。残念ながら、BitcoinのECDSAと互換性のある閾値署名は、作成に計算量が多く、複雑さも多項式となります。シュナー署名のような他のスキームははるかに低いコストを提供しますが、それらがビットコインのプロトコルに導入される可能性があるスケジュールは不明です。

預金の最終的なセキュリティは、多数のバリデータに依存しているため、他の選択肢の1つは、マルチ署名の鍵保持者をバリデータ全体のうち緊密に結合した部分集合のみに減らし、閾値署名が実現可能になるようにすることである（または、最悪の場合、ビットコインのネイティブマルチ署名が実現可能となる）。これはもちろん、バリデータが不正を行った場合に賠償金として差し引かれる債券の 総額を減らすことになるが、これは猶予のある劣化であり、2つのネットワーク間で安全に運用できる資金の上限を設定するだけである（実際、バリデータからの攻撃が成功した場合の損失の割合を設定するだけである）。

そのため、2つのネットワーク間に合理的に安全なビットコインの相互運用性「仮想パラシェーン」を配置することは非現実的ではないと考えますが、それでも不確かなタイムラインでかなりの努力が必要で、そのネットワーク内の利害関係者の協力が必要になる可能性が高いです。
